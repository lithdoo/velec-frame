{
  "code": "// $ config \r\n// const fs = require('fs')\r\n// const url = require('url')\r\n// const path = require('path')\r\n\r\nconst [$, config] = arguments\r\n\r\nconst fs = $.get('fs')\r\nconst url = $.get('url')\r\nconst path = $.get('path')\r\nlet dir_path = config['dir_path']\r\n\r\nconst main = async () => {\r\n    if(dir_path.indexOf('file://') !== -1) {\r\n        dir_path = url.fileURLToPath(dir_path)\r\n    }\r\n    \r\n    if(!fs.existsSync(dir_path)) {\r\n        throw('file not exist')\r\n    } \r\n    \r\n    const stat  = await fs.promises.stat(dir_path)\r\n    const isDir = stat.isDirectory()\r\n\r\n    if(!isDir) {\r\n        throw('file is not a directory')\r\n    }\r\n    \r\n    const list = await fs.promises.readdir(dir_path)\r\n    console.log(list)\r\n    const files = []\r\n\r\n    for (const fileName of list) {\r\n        const filePath = path.join(dir_path, fileName)\r\n\r\n        try{\r\n            const stat = await fs.promises.stat(filePath)\r\n            const isFile = stat.isFile()\r\n            if(isFile) {\r\n                files.push({\r\n                    $name: fileName,\r\n                    $url: url.pathToFileURL(filePath).href,\r\n                    $size: stat.size || 0\r\n                })\r\n            }\r\n        }catch(e) {\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n    return files\r\n}\r\n\r\nreturn main()\r\n"
}